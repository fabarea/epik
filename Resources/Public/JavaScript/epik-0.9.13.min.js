if(String.prototype.decode==null){String.prototype.decode=function(){var c=this;var a=this.match(/_[0-9]+_/g);if(a){for(var b=0;b<a.length;b++){regexp=new RegExp(a[b],"g");c=c.replace(regexp,String.fromCharCode(a[b].replace(/_/g,"")))}}return c.toString()}}if(String.prototype.encode==null){String.prototype.encode=function(b){var c="";for(var a=0;a<this.length;a++){if(this.charAt(a).search(/[-A-Za-z0-9]/)==-1){c+="_"+this.charCodeAt(a)+"_"}else{c+=this.charAt(a)}}return c.toString()}}if(String.prototype.endsWith==null){String.prototype.endsWith=function(a){return(this.match(a+"$")==a)}}function EPIK(w,d){if(typeof(console)=="object"&&typeof(console.log)=="function"){this.log=function(y){console.log("EPIK: "+y)}}else{this.log=function(y){}}this.CONSTANTS=new Object();this.CONSTANTS.CONFIG=new Object();this.CONSTANTS.CONFIG.SECURE_COOKIE="secure_cookie";this.CONSTANTS.CONFIG.ENABLE_JQUERY="enable_jquery";this.CONSTANTS.CONFIG.IFRAME_CONTAINER="iframe_container";this.CONSTANTS.CONFIG.AUTO_SUBMIT="auto_submit";this.CONSTANTS.CONFIG.IFRAME_LOADING_PAGE="iframe_loading_page";this.CONSTANTS.CONFIG.TRIGGER_EVENT="trigger_event";this.CONSTANTS.PAYMENT_METHODS=new Object();this.CONSTANTS.PAYMENT_METHODS.SMS="sms";this.CONSTANTS.PAYMENT_METHODS.VISA="visa";this.CONSTANTS.PAYMENT_METHODS.ECA="eca";this.CONSTANTS.PAYMENT_METHODS.AMX="amx";this.CONSTANTS.PAYMENT_METHODS.PEX="pex";this.CONSTANTS.PAYMENT_METHODS.EZS="ezs";this.CONSTANTS.PAYMENT_METHODS.ES="es";this.CONSTANTS.PAYMENT_METHODS.POS="pos";this.CONSTANTS.PAYMENT_METHODS.PFC="pfc";this.CONSTANTS.PAYMENT_METHODS.PEF="pef";this.CONSTANTS.FORM_FIELD=new Object();this.CONSTANTS.FORM_FIELD.AMOUNT="amount";this.CONSTANTS.FORM_FIELD.CURRENCY="currency";this.CONSTANTS.FORM_FIELD.SUCCESS_URL="success_url";this.CONSTANTS.FORM_FIELD.ERROR_URL="error_url";this.CONSTANTS.FORM_FIELD.CANCEL_URL="cancel_url";this.CONSTANTS.FORM_FIELD.TEST_MODE="test_mode";this.CONSTANTS.FORM_FIELD.MOBILE_MODE="mobile_mode";this.CONSTANTS.FORM_FIELD.POLLSTATUS_URL="pollstatus_url";this.CONSTANTS.FORM_FIELD.PAYMENT_METHOD="payment_method";this.CONSTANTS.FORM_FIELD.LANGUAGE="language";this.CONSTANTS.FORM_FIELD.TRANSACTION_ID="transaction_id";this.CONSTANTS.FORM_FIELD.REFNO="refno";this.CONSTANTS.FORM_FIELD.MSISDN="msisdn";this.CONSTANTS.FORM_FIELD.SID="sid";this.CONSTANTS.FORM_FIELD.KEYWORD="keyword";this.CONSTANTS.FORM_FIELD.ES_MESSAGE="es_message";this.CONSTANTS.FORM_FIELD.POPUP="popup";this.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME="card_holder_name";this.CONSTANTS.FORM_FIELD.RECURRING="recurring";this.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL="recurring_interval";this.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX="payer_line";this.CONSTANTS.HTTP_METHOD=new Object();this.CONSTANTS.HTTP_METHOD.POST="POST";this.CONSTANTS.HTTP_METHOD.GET="GET";var i=new Object();i.currency={hidden:false,mandatory:true,sendToEpp:true};i.amount={hidden:false,mandatory:true,sendToEpp:true};i.error_url={hidden:true,mandatory:true,sendToEpp:true};i.cancel_url={hidden:true,mandatory:true,sendToEpp:true};i.success_url={hidden:true,mandatory:true,sendToEpp:true};i.payment_method={hidden:false,mandatory:true,sendToEpp:true};i.test_mode={hidden:true,mandatory:true,sendToEpp:true};i.pollstatus_url={hidden:true,mandatory:false,sendToEpp:false};i.mobile_mode={hidden:true,mandatory:true,sendToEpp:true};i.popup={hidden:true,mandatory:false,sendToEpp:true};i.language={hidden:false,mandatory:true,sendToEpp:true};i.transaction_id={hidden:true,mandatory:false,sendToEpp:true};i.msisdn={hidden:false,mandatory:false,sendToEpp:true};i.sid={hidden:true,mandatory:false,sendToEpp:true};i.keyword={hidden:false,mandatory:false,sendToEpp:true};i.es_message={hidden:false,mandatory:false,sendToEpp:true};i.recurring={hidden:false,mandatory:false,sendToEpp:true};i.recurring_interval={hidden:false,mandatory:false,sendToEpp:true};i.stored_customer_email={hidden:false,mandatory:false,sendToEpp:true};i.secure_cookie={hidden:true,mandatory:false,sendToEpp:false};i.method={hidden:true,mandatory:false,sendToEpp:false};i.addmerchantparameter_url={hidden:true,mandatory:false,sendToEpp:false};i.setfinalstatus_url={hidden:true,mandatory:false,sendToEpp:false};i.apiendpoint={hidden:true,mandatory:false,sendToEpp:false};i.enable_jquery={hidden:true,mandatory:false,sendToEpp:false};i.iframe_container={hidden:true,mandatory:false,sendToEpp:false};i.trigger_event={hidden:true,mandatory:false,sendToEpp:false};i.auto_submit={hidden:true,mandatory:false,sendToEpp:false};i.iframe_loading_page={hidden:true,mandatory:false,sendToEpp:false};this.log("Config parameters initialized");var n={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(B){for(var y=0;y<B.length;y++){var z=B[y].string;var A=B[y].prop;this.versionSearchString=B[y].versionSearch||B[y].identity;if(z){if(z.indexOf(B[y].subString)!=-1){return B[y].identity}}else{if(A){return B[y].identity}}}},searchVersion:function(z){var y=z.indexOf(this.versionSearchString);if(y==-1){return}return parseFloat(z.substring(y+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};n.init();this.log("Check Browser and Browser Version.");if((n.browser=="Firefox"&&n.version<3.4)||(n.browser=="Explorer"&&n.version<8)||(n.browser=="Chrome"&&n.version<6)||(n.browser=="Safari"&&n.version<4)||(n.browser=="Opera"&&n.version<8)){this.log("NotSupportedBrowser")}var j=this;this.options=new Object();var v=function(){};this.beforeSubmit=function(y){v=y;j.options.before_submit=y};this.setSubmitHandler=function(y){j.options.submit_handler=y};if(typeof jQuery=="undefined"&&typeof EPIK.jq=="undefined"){throw"NojQueryException"}else{if(typeof EPIK.jq=="undefined"){var t="true";if(typeof w=="string"&&typeof d=="object"){if(d.enable_jquery){t=d.enable_jquery}}else{if(typeof w=="object"&&!d){if(w.enable_jquery){t=w.enable_jquery}}}if(t=="false"){EPIK.jq=jQuery.noConflict(true)}else{EPIK.jq=jQuery}}}if(EPIK.jq().jquery<"1.4"){throw"NotSupportedjQueryVersionException : Version greater than 1.4 is needed"}var h=function(){var y=null;if(document.forms.length==1){y=EPIK.jq(document.forms[0])}else{if(document.forms.length>1){throw"MoreThanOneFormFoundException"}else{throw"FormNotFoundException"}}return y};var b=null;this.formKey="";if(!w){b=h()}else{if(typeof w=="string"){b=EPIK.jq("#"+w);this.formKey=w;if(d){this.options=d}}else{if(typeof w=="object"&&!d){b=h();this.options=w}}}if(this.options.iframe_container!=""){var a=EPIK.jq("#"+this.options.iframe_container);if(a.length==0){this.options.iframe_container=""}}if(this.options.before_submit){v=this.options.before_submit}var k=function(A,C){var y=b.find(":input[name="+A+"]");var z="";if(y.attr("type")){z=y.attr("type").toLowerCase()}var B="click";if(j.options.trigger_event){B=j.options.trigger_event}if(z!="radio"&&z!="checkbox"){y.val(C);y.trigger(B,true)}else{y.each(function(){if(EPIK.jq(this).val()==C){EPIK.jq(this).trigger(B,true);EPIK.jq(this)[0].checked=true}else{EPIK.jq(this)[0].checked=false}})}};var p=function(A){var y=b.find(":input[name="+A+"]");var z="";if(y.attr("type")){z=y.attr("type").toLowerCase()}if(z!="radio"&&z!="checkbox"&&z!="submit"&&z!="button"){return y.val()}else{return EPIK.jq(y.selector+":checked").val()?EPIK.jq(y.selector+":checked").val():""}};this.readCookie=function(B){var C="epik_"+B+"=";var A=document.cookie.split(";");for(var z=0;z<A.length;z++){var y=EPIK.jq.trim(A[z]);if(y.indexOf(C)==0){return y.substring(C.length,y.length)}}return null};this.readValueFromCookie=function(z,D){var C=this.readCookie(D);if(C!=null){var B=C.split("&");for(var A in B){if(B[A].indexOf(z.encode()+":")!=-1){var y=B[A].split(":");if(y.length==2){return y[1].decode()}}}}return null};this.removeFromCookieString=function(y,A){var z=j.readCookie(A);var B=y.encode();if(z!=null){var D=z.indexOf(B+":");if(D!=-1){var C=z.indexOf("&",D);if(C==-1){z=z.substring(0,D-1)}else{z=z.substring(0,D)+z.substring(C+1,z.length)}}}else{z=""}return z};this.removeFromCookie=function(y,z){document.cookie="epik_"+z+"="+this.removeFromCookieString(y,z)+"; ; path=/"};this.deleteCookie=function(z){var y=new Date();y.setTime(y.getTime()-(24*60*60*1000));var A="";if(j.options.secure_cookie&&j.options.secure_cookie=="true"){A="secure;"}document.cookie="epik_"+z+"=null; expires="+y.toGMTString()+"; path=/;"+A};this.updateCookie=function(y,C,B){var A=j.readCookie(B);var E=y.encode();var F=null;if(y!=="cardno"&&y!=="cvv"&&y!=="expy"&&y!=="expm"){if(typeof C=="number"||typeof C=="object"||typeof C=="undefined"){F=C+""}else{if(typeof C=="boolean"){F=C?"1":"0"}else{F=C.encode()}}var z=E+":"+F;if(A==null){A=""}if(A.indexOf(E+":")!=-1&&((A.indexOf(z)==-1&&F!="")||(F==""))){A=j.removeFromCookieString(y,B)}if(A.indexOf(E+":")==-1&&A.indexOf(z)==-1){if(A!=""){A+="&"}A+=z}var D="";if(j.options.secure_cookie&&j.options.secure_cookie=="true"){D="secure;"}document.cookie="epik_"+B+"="+A+"; ; path=/;"+D}};var m=this.readCookie(this.formKey)?this.readCookie(this.formKey).split("&"):new Array();for(var c in m){var f=m[c].split(":");if(f.length==2){var e=f[0].decode();var l=f[1].decode();if(!this.options[e]){this.options[e]=l}}}var r=this.readCookie(this.formKey+"_merchantparameter")?this.readCookie(this.formKey+"_merchantparameter").split("&"):new Array();for(var c in r){var u=r[c].split(":");if(u.length==2){var x=u[0].decode();var q=u[1].decode();if(!this.options[x]){this.options[x]=q}}}b.find(":input:not(:button):not(:submit):not(:radio):not(:checkbox),:input:checkbox:checked,:input:radio:checked").each(function(){var B=EPIK.jq(this);var A=B.attr("name");if(A){var z=p(A);if(z!=""){var y=j.formKey;if(!i[A]){y=y+"_merchantparameter"}if(A=="amount"){z=parseFloat(z)}if(!j.options[A]||j.options[A]==""){j.options[A]=z;j.updateCookie(A,z,y)}}}});b.find(":input:not(:button):not(:submit)").live("change",function(C,z){var D=EPIK.jq(this);var B=D.attr("name");if(B&&!z){var A=p(B);var y=j.formKey;if(!i[B]){y=y+"_merchantparameter"}if(B=="amount"){A=parseFloat(A)}j.options[B]=A;j.updateCookie(B,A,y)}});if(!this.options.method){this.options.method="POST";if(b.attr("method")==""){b.attr("method",this.options.method)}}if(!this.options.mobile_mode){this.options.mobile_mode=false}if(!this.options.delete_data_after_submit){this.options.delete_data_after_submit=false}var o=function(){var z=j;var y=i;try{b.find(":input:not(:button):not(:submit):not(:radio):not(:checkbox),:input:checkbox:checked,:input:radio:checked").each(function(){var E=EPIK.jq(this);var D=E.attr("name");if(D){var C=p(D);var B=z.formKey;if(!y[D]){B=B+"_merchantparameter"}if(D=="amount"){C=parseFloat(C)}z.updateCookie(D,C,B)}})}catch(A){}};var s=function(){j.log("auto submit form called");o();var y=true;try{if(b.attr("action")==""){if(j.getApiEndpoint()&&j.getApiEndpoint()!=""){b.attr("action",j.getApiEndpoint())}else{throw"NotDefinedApiEndpointException"}}y=v();if(typeof y!="undefined"&&!y){return false}if(b.attr("action")==j.getApiEndpoint()){j.updateForm(true);j.validateForm();if(!j.options.submit_handler){if(j.options.iframe_container&&j.options.iframe_container!=""){j.createAndSubmitIFrame();y=false}else{y=true}if(typeof j.options.delete_data_after_submit!="undefined"&&j.options.delete_data_after_submit&&j.options.delete_data_after_submit!="false"){j.deleteData()}if(!y){return y}}else{j.log("submit handler called");j.options.submit_handler();return false}}else{if(typeof j.options.submit_handler=="function"){j.options.submit_handler();return false}}}catch(z){j.log(z);return false}return true};this.makeReadyToSubmit=function(){j.log("make ready to submit called");o();var y=true;try{if(b.attr("action")==""){b.attr("action",j.getApiEndpoint())}y=v();if(typeof y!="undefined"&&!y){return false}if(b.attr("action")==j.getApiEndpoint()){j.updateForm(true);j.validateForm();if(typeof j.options.submit_handler=="function"){j.options.submit_handler()}}else{if(typeof j.options.submit_handler=="function"){j.options.submit_handler()}}}catch(z){return false}return true};if(typeof this.options.auto_submit=="undefined"||this.options.auto_submit=="true"){b.submit(function(){return s()})}else{b.submit(function(){return false})}this.updateForm=function(y){j.log("update form called");this.createMandatoryAndNotHiddenFormFields(y);this.createHiddenFormFields();this.createMerchantParameterFields()};this.createMandatoryAndNotHiddenFormFields=function(D){if(!D){D=false}var C;var B;for(var A in i){if(!i[A].hidden&&i[A].mandatory){C=b.find(":input[name="+A+"]");if(C.length==0){var z=j.options[A];if(A=="amount"&&z){z=parseFloat(z)}var y="hidden";if(!D){B=EPIK.jq("<label/>").text(A);b.append(B);y="text"}j.createFormField(A,y,z)}}}};this.createHiddenFormFields=function(){for(var y in i){if(i[y].hidden&&i[y].sendToEpp){j.createFormField(y,"hidden",j.options[y])}}};this.createFormField=function(z,y,B){var A;var C;A=b.find(":input[name="+z+"]");if(typeof B!="function"){if(A.length==0){C=EPIK.jq("<input/>").attr({type:y,value:(B?B:""),name:z});b.append(C)}else{if(A.val()==""){A.val(B?B:"")}}}};this.createMerchantParameterFields=function(){var z;for(var y in j.options){z=b.find(":input[name="+y+"]");if(!i[y]&&z.length==0&&j.options[y]){j.createFormField(y,"hidden",j.options[y])}}};this.validateForm=function(){j.log("validate form called");var A;for(var z in i){if(i[z].mandatory){A=b.find(":input[name="+z+"]");if(A.length==0){throw"MandatoryFieldNotFoundException: Form field "+z+" is missing."}else{var y="";if(A.attr("type")){y=A.attr("type")}if(y!="radio"&&y!="checkbox"){if(!EPIK.jq.trim(A.val())){throw"MandatoryFieldNotFoundException: Form field "+z+" is missing."}}else{if(EPIK.jq(A.selector+":checked").length<1){throw"MandatoryFieldNotFoundException: Form field "+z+" is missing."}}}}}if(j.getRecurring()=="true"){if(!j.options.stored_customer_email){throw ("Parameter stored_customer_email not defined")}if(!j.options.recurring_interval){throw ("Parameter recurring_interval not defined")}}};this.deleteData=function(){j.deleteCookie(j.formKey);j.deleteCookie(j.formKey+"_merchantparameter")};this.fillOutForm=function(B){j.log("fill out form called");if(!B){B=false}var A;for(var z in j.options){A=b.find(":input[name="+z+"]");if(A.length!=0){var y=A.attr("type");if(!y){y=""}if(B||(A.val()==""||(A.is("select")||y=="radio"||y=="checkbox"))){if(z=="amount"){k(z,parseFloat(j.options[z]))}else{k(z,j.options[z])}}}}};this.addStoredMerchantParameterField=function(A){if(!A.name){throw"StoredMerchantFieldNameIsMissingException"}if(!A.label){A.label=A.name}if(!A.value){A.value=""}if(!A.parent_container){A.parent_container=b}var y="text";if(!A.hidden){A.hidden=false;y="hidden"}if(!A.classes){A.classes=""}var z="";if(!A.hidden){z="<label>"+A.label+"</label>"}A.parent_container.append(z+'<input name="stored_'+A.name+'" type="'+y+'" class="'+A.classes+'" value="'+A.value+'"/>');j.setStoredMerchantParameter(A.name,A.value)};this.addMerchantParameterField=function(A){if(!A.name){throw"MerchantFieldNameIsMissingException"}if(!A.label){A.label=A.name}if(!A.value){A.value=""}if(!A.parent_container){A.parent_container=b}var y="text";if(!A.hidden){A.hidden=false;y="hidden"}if(!A.classes){A.classes=""}var z="";if(!A.hidden){z="<label>"+A.label+"</label>"}A.parent_container.append(z+'<input name="'+A.name+'" type="'+y+'" class="'+A.classes+'" value="'+A.value+'"/>');j.setMerchantParameter(A.name,A.value)};this.setCurrency=function(y){y=y.toLowerCase();j.options.currency=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.CURRENCY,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.CURRENCY,y)};this.setAmount=function(z){var y=0;y=parseFloat(z);j.options.amount=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.AMOUNT,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.AMOUNT,y)};this.setErrorUrl=function(y){j.options.error_url=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.ERROR_URL,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.ERROR_URL,y)};this.setCancelUrl=function(y){j.options.cancel_url=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.CANCEL_URL,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.CANCEL_URL,y)};this.setSuccessUrl=function(y){j.options.success_url=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.SUCCESS_URL,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.SUCCESS_URL,y)};this.setApiEndpoint=function(y){j.options.apiendpoint=y;j.updateCookie("apiendpoint",y,j.formKey);b.attr("action",y)};this.setMethod=function(y){j.options.method=y;j.updateCookie("method",y,j.formKey);b.attr("method",y)};this.setPollStatusUrl=function(y){j.options.pollstatus_url=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL,y)};this.setPaymentMethod=function(y){y=y.toLowerCase();j.options.payment_method=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.PAYMENT_METHOD,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.PAYMENT_METHOD,y)};this.setTestMode=function(y){y=y.toLowerCase();j.options.test_mode=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.TEST_MODE,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.TEST_MODE,y)};this.setMobileMode=function(y){y=y.toLowerCase();j.options.mobile_mode=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.MOBILE_MODE,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.MOBILE_MODE,y)};this.setLanguage=function(y){y=y.toLowerCase();j.options.language=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.LANGUAGE,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.LANGUAGE,y)};this.setStoredMerchantParameter=function(y,z){if(y.indexOf("stored_")!=0){throw"ParameterNameException : Parameter has to start with stored_"}j.options[y]=z;j.updateCookie(y,z,j.formKey+"_merchantparameter");k(y,z)};this.setMerchantParameter=function(y,z){if(y.indexOf("stored_")==0){throw"ParameterNameException : Parameter may not start with stored_"}j.options[y]=z;j.updateCookie(y,z,j.formKey+"_merchantparameter");k(y,z)};this.setTransactionId=function(y){j.options.transaction_id=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.TRANSACTION_ID,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.TRANSACTION_ID,y)};this.setRefNo=function(y){j.options.refno=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.REFNO,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.REFNO,y)};this.setESMessage=function(y){j.options.es_message=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.ES_MESSAGE,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.ES_MESSAGE,y)};this.setMSISDN=function(y){j.options.msisdn=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.MSISDN,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.MSISDN,y)};this.setSID=function(y){j.options.sid=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.SID,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.SID,y)};this.setKeyword=function(y){j.options.keyword=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.KEYWORD,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.KEYWORD,y)};this.setPayerLine=function(y,A){var z=j.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX+y;this.createFormField(z,"hidden",A);j.options[z]=A;j.updateCookie(z,A,j.formKey);k(z,A)};this.setPopUp=function(y){j.options.popup=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.POPUP,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.POPUP,y)};this.setCardHolderName=function(y){j.options.card_holder_name=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME,y)};this.setRecurring=function(y){j.options.recurring=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.RECURRING,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.RECURRING,y)};this.setRecurringInterval=function(y){j.options.recurring_interval=y;j.updateCookie(j.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL,y,j.formKey);k(j.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL,y)};this.setSecureCookie=function(y){j.options.secure_cookie=y;j.updateCookie(this.CONSTANTS.CONFIG.SECURE_COOKIE,y,j.formKey)};this.getCurrency=function(){return j.options.currency};this.getAmount=function(){return j.options.amount};this.getErrorUrl=function(){return j.options.error_url};this.getCancelUrl=function(){return j.options.cancel_url};this.getSuccessUrl=function(){return j.options.success_url};this.getApiEndpoint=function(){return j.options.apiendpoint};this.getMethod=function(){return j.options.method};this.getPollStatusUrl=function(){return j.options.pollstatus_url};this.getPaymentMethod=function(){return j.options.payment_method};this.getTestMode=function(){return j.options.test_mode};this.getMobileMode=function(){return j.options.mobile_mode};this.getLanguage=function(){return j.options.language};this.getMerchantParameter=function(y){if(y.indexOf("stored_")==0){throw"ParameterNameException : Parameter may not start with stored_"}return j.options[y]};this.getStoredMerchantParameter=function(y){if(y.indexOf("stored_")!=0){throw"ParameterNameException : Parameter has to start with stored_"}return j.options[y]};this.getTransactionId=function(){return j.options.transaction_id};this.getRefNo=function(){return j.options.refno};this.getESMessage=function(){return j.options.es_message};this.getPayerLine=function(y){return j.options[j.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX+y]};this.getMSISDN=function(){return j.options.msisdn};this.getSID=function(){return j.options.sid};this.getKeyword=function(){return j.options.keyword};this.getPopUp=function(){return j.options.popup};this.getCardHolderName=function(){return j.options.card_holder_name};this.getRecurring=function(){return j.options.recurring};this.getRecurringInterval=function(){return j.options.recurring_interval};this.getSecureCookie=function(){return j.options.secure_cookie};this.createAndSubmitIFrame=function(){var B=j.options.iframe_container;var A=b;if(B){A=EPIK.jq("#"+B);if(A.length==0){throw"NoElementFoundException"}}var C="#";if(j.options.iframe_loading_page){C=j.options.iframe_loading_page}var y=EPIK.jq("<iframe/>").attr({width:"100%",height:"100%",name:"epp_iframe",frameborder:0,src:C});var z=EPIK.jq("<form/>").attr({action:j.getApiEndpoint(),method:j.getMethod()});b.find(":input:not(:button):not(:submit):not(:radio):not(:checkbox),:input:checkbox:checked,:input:radio:checked").each(function(){var G=EPIK.jq(this);var F=G.attr("name");if(F){var E=p(F);if(F=="amount"&&E){E=parseFloat(E)}if(j.options.iframe_landing_url&&j.options.iframe_landing_url!=""){if((F=="success_url"||F=="cancel_url"||F=="error_url")&&E){E=j.options.iframe_landing_url}}var D=EPIK.jq("<input/>").attr({type:"hidden",name:F,value:E});z.append(D)}});A.find("iframe[name=epp_iframe]").remove();A.append(y);j.waitUntilLoaded(y,z,C)};this.waitUntilLoaded=function(D,B,C){var y=D;var z=B;var A=C;if(j.options.iframe_loaded){y.contents().find("body").append(z);j.options.iframe_loaded=false;y.contents().find("body form").submit()}else{if(A=="#"){setTimeout(function(){y.contents().find("body").append(z);y.contents().find("body form").submit()},1000)}else{setTimeout(function(){j.waitUntilLoaded(y,z,A)},250)}}};this.redirectToParent=function(){var A=j.getQueryParamValueFromUrl("epayment_status");var y=j.getQueryParamValueFromUrl("error-0");var z=self.location.search;j.addQueryParamsToEpikOptions();if(A=="success"){self.parent.location.href=j.getSuccessUrl()+z;return}else{if(A=="aborted_by_user"){self.parent.location.href=j.getCancelUrl()+z;return}}if(y&&y!=""){self.parent.location.href=j.getErrorUrl()+z;return}};this.waitForConfirmation=function(y){j.stopCounter=false;j.stopPolling=false;j.countTimer=null;j.pollTimer=null;j.countDown(y.start_minutes,y.start_seconds,y.container_id,y.timedout);j.pollStatus(y.merchant_transaction_id,y.epp_transaction_id,y.confirmed,y.declined,y.interval)};this.abortWaitForConfirmation=function(){if(j.countTimer!==null){clearTimeout(j.countTimer)}if(j.pollTimer!==null){clearTimeout(j.pollTimer)}j.stopCounter=true;j.stopPolling=true;j.countTimer=null;j.pollTimer=null};this.countDown=function(A,B,z,y){if(B==0){A=A-1;B=59}else{B=B-1}j.showSMSCounter(A,B,z);if(A>0||B>0){if(!j.stopCounter){j.countTimer=setTimeout(function(){j.countDown(A,B,z,y)},1000)}}else{if(!j.stopCounter){j.stopPolling=true;y()}}};this.showSMSCounter=function(z,A,y){if(z<10){z="0"+z}if(A<10){A="0"+A}$("#"+y).html(z+":"+A)};this.pollStatus=function(C,D,B,A,y){var z=j.options[j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL]+"?merchant-trx-id="+C;if(D){z=j.options[j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL]+"?transaction-id="+D}EPIK.jq.ajax({url:z,cache:false,dataType:"json",success:function(E){j.parseStatusResponse(E,C,D,B,A,y)},error:function(F,E,G){}})};this.parseStatusResponse=function(B,C,D,A,z,y){if(B.status=="pending"){if(!j.stopPolling){j.pollTimer=setTimeout(function(){j.pollStatus(C,D,A,z,y)},y*1000)}}else{if(B.status=="confirmed"){j.stopCounter=true;A()}else{j.stopCounter=true;z()}}};this.addQueryParamsToEpikOptions=function(){var z=j.getQueryParams();for(var y in z){if(j.options[y]){if(j.options[y]!=z[y]){}}else{j.options[y]=z[y];j.updateCookie(y,z[y],j.formKey)}}};this.getQueryParams=function(){var y=self.location.href;if(y.endsWith("#")){y=y.substring(0,y.length-1)}y.match(/\?(.+)$/);var C=RegExp.$1;C=C.split("&");var B={};for(var A=0;A<C.length;A++){var z=C[A].split("=");B[z[0]]=decodeURIComponent(z[1])}return B};this.getQueryParamValueFromUrl=function(y){return j.getQueryParams()[y]};var g=function(B){var A=Array(0,9,4,6,8,2,7,1,3,5);var z=0;for(var y=0;y<B.length;y++){z=A[(z+parseInt(B.substr(y,1)))%10]}return(10-z)%10};this.createCompleteRefNo=function(E,A){if(!E||(E+"").length!=6){throw"BankingCustomerIdentificationException"}if(!A){A=""}if(typeof A!="string"){throw"FormatException: Code must be a string"}var C=(E+"").length+(A+"").length;var z="000000000000000000000000000";if(C>27){throw"OutOfRangeException: Only 20 digits are allowed for the code"}else{if(C==27){var y=(E+"")+(A+"");if(g(y.substr(0,y.length-1))==y.substr(y.length-1)){throw"CheckDigitException"}else{z=y}}else{var D=27-C-1;var B="";if(D>0){B=(Math.pow(10,D)+"").substr(1)}z=(E+"")+B+(A+"");z=z+g(z)}}return z};this.getBaseUri=function(){var y=j.options.apiendpoint;if(y.indexOf("http")==0){y=y.substring(0,y.indexOf("/",8)+1)}else{y=""}return y};this.getMerchantConfigId=function(){var z=j.options.apiendpoint;var y="";var A=z.lastIndexOf("/");if(z.length-1>A){y=z.substr(A+1)}else{z=z.substring(0,A);y=z.substr(z.lastIndexOf("/")+1)}return y};this.sendMerchantParameter=function(F,z,B,E,D){var C=E;var A=D;var y=j.options.addmerchantparameter_url;if(y.length>0){EPIK.jq.ajax({url:y,type:"POST",data:"transaction-id="+F+"&parameter-name="+encodeURIComponent(z)+"&parameter-value="+encodeURIComponent(B),success:function(G){if(typeof C=="function"){C(G)}},error:function(H,G,I){if(typeof C=="function"){A(H,G,I)}}})}};this.sendFinalSuccessStatus=function(D,C,B){var A=C;var z=B;var y=j.options.setfinalstatus_url;if(y.length>0){EPIK.jq.ajax({url:y,type:"POST",data:"transaction-id="+D,success:function(E){if(typeof A=="function"){A(E)}},error:function(F,E,G){if(typeof A=="function"){z(F,E,G)}}})}}}EPIK.utils={getInternetExplorerVersion:function(){var a;if(navigator.appName==="Microsoft Internet Explorer"){a=/MSIE ([0-9]{1,}\.?[0-9]{0,})/.exec(navigator.userAgent);if(a!==null){return parseFloat(a[1])}}return -1},normalizeMSISDN:function(b){b=b.replace(/\s/g,"");var a=/^(\+41|0041|0)(7[6789][0-9]{7})$/g.exec(b);if(a===null){return null}return"+41"+a[2]},getCreditCardType:function(a){if(a.match(/^(4)/g)){return"vis"}else{if(a.match(/^(5[0-5])/g)){return"eca"}else{if(a.match(/^3[4|7]/g)){return"amx"}}}return null}};